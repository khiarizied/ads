<!-- src/main/resources/templates/fragments/header.html -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>Header Fragment</title>
</head>
<body>
    <header th:fragment="header" class="bg-white shadow">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="/" class="text-xl font-bold text-indigo-600">
                        <i class="fas fa-home mr-2"></i>RealEstate
                    </a>
                    <nav class="ml-10 flex space-x-8">
                        <a href="/" class="text-gray-900 inline-flex items-center px-1 pt-1 text-sm font-medium">Home</a>
                        <a href="#" class="text-gray-500 hover:text-gray-900 inline-flex items-center px-1 pt-1 text-sm font-medium">Properties</a>
                        <a href="#" class="text-gray-500 hover:text-gray-900 inline-flex items-center px-1 pt-1 text-sm font-medium">Agents</a>
                        <a href="#" class="text-gray-500 hover:text-gray-900 inline-flex items-center px-1 pt-1 text-sm font-medium">Contact</a>
                    </nav>
                </div>
                <div class="flex items-center">
                    <div sec:authorize="isAuthenticated()">
                        <div class="flex items-center ml-4">
                            <div class="relative">
                                <button id="user-menu-button" class="flex items-center text-sm rounded-full focus:outline-none">
                                    <img class="h-8 w-8 rounded-full object-cover" 
                                         th:src="@{/photos/users/{username}(username=${#authentication.name})}"
                                         th:alt="${#authentication.name}"
                                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjYzNjM2MzIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTEyIDEyYzIuNzYxIDAgNS0yLjIzOSA1LTVzLTIuMjM5LTUtNS01LTUgMi4yMzktNSA1IDIuMjM5IDUgNSA1em0wIDJjLTIuNjcgMC04IDEuMzQtOCA0djJoMjB2LTJjMC0yLjY2LTMuMTMtNC04LTR6Ii8+PC9zdmc+'">
                                </button>
                                <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                                    <div class="px-4 py-2 border-b">
                                        <p class="text-sm font-medium text-gray-900" 
                                           th:text="${#authentication.name}">Username</p>
                                        <p class="text-xs text-gray-500 truncate" 
                                           th:text="${#authentication.principal.authorities.toString().replace('[ROLE_', '').replace(']', '')}">Role</p>
                                    </div>
                                    <a href="/admin/dashboard" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                                    </a>
                                    <a href="/admin/users" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <i class="fas fa-users mr-2"></i>Manage Users
                                    </a>
                                    <form th:action="@{/logout}" method="post" class="border-t">
                                        <button type="submit" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                            <i class="fas fa-sign-out-alt mr-2"></i>Sign out
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div sec:authorize="!isAuthenticated()">
                        <a href="/auth/login" class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700">
                            Login
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const userMenuButton = document.getElementById('user-menu-button');
            const userDropdown = document.getElementById('user-dropdown');
            
            if (userMenuButton && userDropdown) {
                userMenuButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    userDropdown.classList.toggle('hidden');
                });
                
                document.addEventListener('click', function(e) {
                    if (!userMenuButton.contains(e.target) && !userDropdown.contains(e.target)) {
                        userDropdown.classList.add('hidden');
                    }
                });
            }
        });
    </script>
</body>
</html>