<!-- src/main/resources/templates/fragments/admin-header.html -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>Admin Header Fragment</title>
</head>
<body>
    <header th:fragment="admin-header" class="bg-white shadow">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="/admin/dashboard" class="text-xl font-bold text-indigo-600">
                        <i class="fas fa-home mr-2"></i>Admin Panel
                    </a>
                </div>
                <div class="flex items-center">
                    <div class="flex items-center ml-4">
                        <div class="relative">
                            <button id="admin-user-menu-button" class="flex items-center text-sm rounded-full focus:outline-none">
                                <img class="h-8 w-8 rounded-full object-cover" 
                                     th:src="@{/photos/users/{username}(username=${#authentication.name})}"
                                     th:alt="${#authentication.name}"
                                     onerror="this.src='image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjYzNjM2MzIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTEyIDEyYzIuNzYxIDAgNS0yLjIzOSA1LTVzLTIuMjM5LTUtNS01LTUgMi4yMzktNSA1IDIuMjM5IDUgNSA1em0wIDJjLTIuNjcgMC04IDEuMzQtOCA0djJoMjB2LTJjMC0yLjY2LTMuMTMtNC04LTR6Ii8+PC9zdmc+'">
                                <span class="ml-2 text-gray-700 hidden md:inline" 
                                      th:text="${#authentication.name}">Username</span>
                            </button>
                            <div id="admin-user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                                <div class="px-4 py-2 border-b">
                                    <p class="text-sm font-medium text-gray-900" 
                                       th:text="${#authentication.name}">Username</p>
                                    <p class="text-xs text-gray-500 truncate" 
                                       th:text="${#authentication.principal.authorities[0].authority?.replace('ROLE_', '') ?: 'USER'}">Role</p>
                                </div>
                                <a href="/admin/dashboard" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                                </a>
                                <a href="/admin/users" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-users mr-2"></i>Manage Users
                                </a>
                                <form th:action="@{/logout}" method="post" class="border-t">
                                    <button type="submit" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <i class="fas fa-sign-out-alt mr-2"></i>Sign out
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const adminUserMenuButton = document.getElementById('admin-user-menu-button');
            const adminUserDropdown = document.getElementById('admin-user-dropdown');
            
            if (adminUserMenuButton && adminUserDropdown) {
                adminUserMenuButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    adminUserDropdown.classList.toggle('hidden');
                });
                
                document.addEventListener('click', function(e) {
                    if (!adminUserMenuButton.contains(e.target) && !adminUserDropdown.contains(e.target)) {
                        adminUserDropdown.classList.add('hidden');
                    }
                });
            }
        });
    </script>
</body>
</html>